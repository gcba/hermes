!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Ratings=t()}(this,function(){"use strict";function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}!function(e){function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=String(e)),e}function i(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return y.iterable&&(t[Symbol.iterator]=function(){return t}),t}function n(e){this.map={},e instanceof n?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function s(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function a(e){var t=new FileReader,r=s(t);return t.readAsArrayBuffer(e),r}function l(e){var t=new FileReader,r=s(t);return t.readAsText(e),r}function u(e){for(var t=new Uint8Array(e),r=new Array(t.length),i=0;i<t.length;i++)r[i]=String.fromCharCode(t[i]);return r.join("")}function p(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(y.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(y.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(y.arrayBuffer&&y.blob&&S(e))this._bodyArrayBuffer=p(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!w(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=p(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(u(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}function c(e){var t=e.toUpperCase();return x.indexOf(t)>-1?t:e}function d(e,t){var r=(t=t||{}).body;if(e instanceof d){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new n(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new n(t.headers)),this.method=c(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function h(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),i=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(n))}}),t}function f(e){var t=new n;return e.split(/\r?\n/).forEach(function(e){var r=e.split(":"),i=r.shift().trim();if(i){var n=r.join(":").trim();t.append(i,n)}}),t}function m(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new n(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var y={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(y.arrayBuffer)var g=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],S=function(e){return e&&DataView.prototype.isPrototypeOf(e)},w=ArrayBuffer.isView||function(e){return e&&g.indexOf(Object.prototype.toString.call(e))>-1};n.prototype.append=function(e,i){e=t(e),i=r(i);var n=this.map[e];this.map[e]=n?n+","+i:i},n.prototype.delete=function(e){delete this.map[t(e)]},n.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},n.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},n.prototype.set=function(e,i){this.map[t(e)]=r(i)},n.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},n.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),i(e)},n.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),i(e)},n.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),i(e)},y.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);var x=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this,{body:this._bodyInit})},b.call(d.prototype),b.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},m.error=function(){var e=new m(null,{status:0,statusText:""});return e.type="error",e};var v=[301,302,303,307,308];m.redirect=function(e,t){if(-1===v.indexOf(t))throw new RangeError("Invalid status code");return new m(null,{status:t,headers:{location:e}})},e.Headers=n,e.Request=d,e.Response=m,e.fetch=function(e,t){return new Promise(function(r,i){var n=new d(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:f(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;r(new m(t,e))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.open(n.method,n.url,!0),"include"===n.credentials&&(o.withCredentials=!0),"responseType"in o&&y.blob&&(o.responseType="blob"),n.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===n._bodyInit?null:n._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=e(function(e){!function(t){var r=/iPhone/i,i=/iPod/i,n=/iPad/i,o=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,s=/Android/i,a=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,l=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,u=/Windows Phone/i,p=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,b=/BlackBerry/i,c=/BB10/i,d=/Opera Mini/i,h=/(CriOS|Chrome)(?=.*\bMobile\b)/i,f=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,m=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),y=function(e,t){return e.test(t)},g=function(e){var t=e||navigator.userAgent,g=t.split("[FBAN");if(void 0!==g[1]&&(t=g[0]),void 0!==(g=t.split("Twitter"))[1]&&(t=g[0]),this.apple={phone:y(r,t),ipod:y(i,t),tablet:!y(r,t)&&y(n,t),device:y(r,t)||y(i,t)||y(n,t)},this.amazon={phone:y(a,t),tablet:!y(a,t)&&y(l,t),device:y(a,t)||y(l,t)},this.android={phone:y(a,t)||y(o,t),tablet:!y(a,t)&&!y(o,t)&&(y(l,t)||y(s,t)),device:y(a,t)||y(l,t)||y(o,t)||y(s,t)},this.windows={phone:y(u,t),tablet:y(p,t),device:y(u,t)||y(p,t)},this.other={blackberry:y(b,t),blackberry10:y(c,t),opera:y(d,t),firefox:y(f,t),chrome:y(h,t),device:y(b,t)||y(c,t)||y(d,t)||y(f,t)||y(h,t)},this.seven_inch=y(m,t),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},S=function(){var e=new g;return e.Class=g,e};e.exports&&"undefined"==typeof window?e.exports=g:e.exports&&"undefined"!=typeof window?e.exports=S():t.isMobile=S()}(t)}),i=e(function(e,r){(function(){function i(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function n(e,t,r){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),e=s(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function o(e,t){var r=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=w)for(;++r<i;)t(e[r],r,e);else a(e,t)}function s(e){return e=c(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:i(e)}function a(e,t){for(var r in e)A.call(e,r)&&t(e[r],r,e)}function l(e){return null==e?i(e):P.call(e).slice(8,-1)}function u(e,t){var r=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!e[t])}function p(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function b(e,t){var r=null;return o(e,function(i,n){r=t(r,i,n,e)}),r}function c(e){return String(e).replace(/^ +| +$/g,"")}function d(e){function t(t){return b(t,function(t,r){var i=r.pattern||p(r);return!t&&(t=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(r.label&&!RegExp(i,"i").test(r.label)?r.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),r=r.label||r,t=s(t[0].replace(RegExp(i,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),t})}var r=f,i=e&&"object"==typeof e&&"String"!=l(e);i&&(r=e,e=null);var o=r.navigator||{},h=o.userAgent||"";e||(e=h);var y,g,S=i||v==m,w=i?!!o.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(P.toString()),O=i?"Object":"ScriptBridgingProxyObject",A=i?"Object":"Environment",E=i&&r.java?"JavaPackage":l(r.java),_=i?"Object":"RuntimeObject",M=/\bJava/.test(E)&&r.java,B=M&&l(r.environment)==A,I=M?"a":"α",T=M?"b":"β",k=r.document||{},F=r.operamini||r.opera,R=x.test(R=i&&F?F["[[Class]]"]:l(F))?R:F=null,W=e,j=[],C=null,G=e==h,U=G&&F&&"function"==typeof F.version&&F.version(),K=function(t){return b(t,function(t,r){return t||RegExp("\\b"+(r.pattern||p(r))+"\\b","i").exec(e)&&(r.label||r)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),$=function(t){return b(t,function(t,r){return t||RegExp("\\b"+(r.pattern||p(r))+"\\b","i").exec(e)&&(r.label||r)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),N=t([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(t){return b(t,function(t,r,i){return t||(r[N]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(N)]||RegExp("\\b"+p(i)+"(?:\\b|\\w*\\d)","i").exec(e))&&i})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),X=function(t){return b(t,function(t,r){var i=r.pattern||p(r);return!t&&(t=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=n(t,i,r.label||r)),t})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(K&&(K=[K]),D&&!N&&(N=t([D])),(y=/\bGoogle TV\b/.exec(N))&&(N=y[0]),/\bSimulator\b/i.test(e)&&(N=(N?N+" ":"")+"Simulator"),"Opera Mini"==$&&/\bOPiOS\b/.test(e)&&j.push("running in Turbo/Uncompressed mode"),"IE"==$&&/\blike iPhone OS\b/.test(e)?(D=(y=d(e.replace(/like iPhone OS/,""))).manufacturer,N=y.product):/^iP/.test(N)?($||($="Safari"),X="iOS"+((y=/ OS ([\d_]+)/i.exec(e))?" "+y[1].replace(/_/g,"."):"")):"Konqueror"!=$||/buntu/i.test(X)?D&&"Google"!=D&&(/Chrome/.test($)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(N))||/\bAndroid\b/.test(X)&&/^Chrome/.test($)&&/\bVersion\//i.test(e)?($="Android Browser",X=/\bAndroid\b/.test(X)?X:"Android"):"Silk"==$?(/\bMobi/i.test(e)||(X="Android",j.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&j.unshift("accelerated")):"PaleMoon"==$&&(y=/\bFirefox\/([\d.]+)\b/.exec(e))?j.push("identifying as Firefox "+y[1]):"Firefox"==$&&(y=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(X||(X="Firefox OS"),N||(N=y[1])):!$||(y=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec($))?($&&!N&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(y+"/")+8))&&($=null),(y=N||D||X)&&(N||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(X))&&($=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(X)?X:y)+" Browser")):"Electron"==$&&(y=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&j.push("Chromium "+y):X="Kubuntu",U||(U=function(t){return b(t,function(t,r){return t||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",p($),"(?:Firefox|Minefield|NetFront)"])),(y="iCab"==K&&parseFloat(U)>3&&"WebKit"||/\bOpera\b/.test($)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(K)&&"WebKit"||!K&&/\bMSIE\b/i.test(e)&&("Mac OS"==X?"Tasman":"Trident")||"WebKit"==K&&/\bPlayStation\b(?! Vita\b)/i.test($)&&"NetFront")&&(K=[y]),"IE"==$&&(y=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?($+=" Mobile",X="Windows Phone "+(/\+$/.test(y)?y:y+".x"),j.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?($="IE Mobile",X="Windows Phone 8.x",j.unshift("desktop mode"),U||(U=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=$&&"Trident"==K&&(y=/\brv:([\d.]+)/.exec(e))&&($&&j.push("identifying as "+$+(U?" "+U:"")),$="IE",U=y[1]),G){if(u(r,"global"))if(M&&(W=(y=M.lang.System).getProperty("os.arch"),X=X||y.getProperty("os.name")+" "+y.getProperty("os.version")),S&&u(r,"system")&&(y=[r.system])[0]){X||(X=y[0].os||null);try{y[1]=r.require("ringo/engine").version,U=y[1].join("."),$="RingoJS"}catch(e){y[0].global.system==r.system&&($="Narwhal")}}else"object"==typeof r.process&&!r.process.browser&&(y=r.process)?"object"==typeof y.versions?"string"==typeof y.versions.electron?(j.push("Node "+y.versions.node),$="Electron",U=y.versions.electron):"string"==typeof y.versions.nw&&(j.push("Chromium "+U,"Node "+y.versions.node),$="NW.js",U=y.versions.nw):($="Node.js",W=y.arch,X=y.platform,U=(U=/[\d.]+/.exec(y.version))?U[0]:"unknown"):B&&($="Rhino");else l(y=r.runtime)==O?($="Adobe AIR",X=y.flash.system.Capabilities.os):l(y=r.phantom)==_?($="PhantomJS",U=(y=y.version||null)&&y.major+"."+y.minor+"."+y.patch):"number"==typeof k.documentMode&&(y=/\bTrident\/(\d+)/i.exec(e))?(U=[U,k.documentMode],(y=+y[1]+4)!=U[1]&&(j.push("IE "+U[1]+" mode"),K&&(K[1]=""),U[1]=y),U="IE"==$?String(U[1].toFixed(1)):U[0]):"number"==typeof k.documentMode&&/^(?:Chrome|Firefox)\b/.test($)&&(j.push("masking as "+$+" "+U),$="IE",U="11.0",K=["Trident"],X="Windows");X=X&&s(X)}if(U&&(y=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(U)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(G&&o.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(C=/b/i.test(y)?"beta":"alpha",U=U.replace(RegExp(y+"\\+?$"),"")+("beta"==C?T:I)+(/\d+\+?/.exec(y)||"")),"Fennec"==$||"Firefox"==$&&/\b(?:Android|Firefox OS)\b/.test(X))$="Firefox Mobile";else if("Maxthon"==$&&U)U=U.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(N))"Xbox 360"==N&&(X=null),"Xbox 360"==N&&/\bIEMobile\b/.test(e)&&j.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test($)&&(!$||N||/Browser|Mobi/.test($))||"Windows CE"!=X&&!/Mobi/i.test(e))if("IE"==$&&G)try{null===r.external&&j.unshift("platform preview")}catch(e){j.unshift("embedded")}else(/\bBlackBerry\b/.test(N)||/\bBB10\b/.test(e))&&(y=(RegExp(N.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||U)?(X=((y=[y,/BB10/.test(e)])[1]?(N=null,D="BlackBerry"):"Device Software")+" "+y[0],U=null):this!=a&&"Wii"!=N&&(G&&F||/Opera/.test($)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==$&&/\bOS X (?:\d+\.){2,}/.test(X)||"IE"==$&&(X&&!/^Win/.test(X)&&U>5.5||/\bWindows XP\b/.test(X)&&U>8||8==U&&!/\bTrident\b/.test(e)))&&!x.test(y=d.call(a,e.replace(x,"")+";"))&&y.name&&(y="ing as "+y.name+((y=y.version)?" "+y:""),x.test($)?(/\bIE\b/.test(y)&&"Mac OS"==X&&(X=null),y="identify"+y):(y="mask"+y,$=R?s(R.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(y)&&(X=null),G||(U=null)),K=["Presto"],j.push(y));else $+=" Mobile";(y=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(y=[parseFloat(y.replace(/\.(\d)$/,".0$1")),y],"Safari"==$&&"+"==y[1].slice(-1)?($="WebKit Nightly",C="alpha",U=y[1].slice(0,-1)):U!=y[1]&&U!=(y[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(U=null),y[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==y[0]&&537.36==y[2]&&parseFloat(y[1])>=28&&"WebKit"==K&&(K=["Blink"]),G&&(w||y[1])?(K&&(K[1]="like Chrome"),y=y[1]||((y=y[0])<530?1:y<532?2:y<532.05?3:y<533?4:y<534.03?5:y<534.07?6:y<534.1?7:y<534.13?8:y<534.16?9:y<534.24?10:y<534.3?11:y<535.01?12:y<535.02?"13+":y<535.07?15:y<535.11?16:y<535.19?17:y<536.05?18:y<536.1?19:y<537.01?20:y<537.11?"21+":y<537.13?23:y<537.18?24:y<537.24?25:y<537.36?26:"Blink"!=K?"27":"28")):(K&&(K[1]="like Safari"),y=(y=y[0])<400?1:y<500?2:y<526?3:y<533?4:y<534?"4+":y<535?5:y<537?6:y<538?7:y<601?8:"8"),K&&(K[1]+=" "+(y+="number"==typeof y?".x":/[.+]/.test(y)?"":"+")),"Safari"==$&&(!U||parseInt(U)>45)&&(U=y)),"Opera"==$&&(y=/\bzbov|zvav$/.exec(X))?($+=" ",j.unshift("desktop mode"),"zvav"==y?($+="Mini",U=null):$+="Mobile",X=X.replace(RegExp(" *"+y+"$"),"")):"Safari"==$&&/\bChrome\b/.exec(K&&K[1])&&(j.unshift("desktop mode"),$="Chrome Mobile",U=null,/\bOS X\b/.test(X)?(D="Apple",X="iOS 4.3+"):X=null),U&&0==U.indexOf(y=/[\d.]+$/.exec(X))&&e.indexOf("/"+y+"-")>-1&&(X=c(X.replace(y,""))),K&&!/\b(?:Avant|Nook)\b/.test($)&&(/Browser|Lunascape|Maxthon/.test($)||"Safari"!=$&&/^iOS/.test(X)&&/\bSafari\b/.test(K[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test($)&&K[1])&&(y=K[K.length-1])&&j.push(y),j.length&&(j=["("+j.join("; ")+")"]),D&&N&&N.indexOf(D)<0&&j.push("on "+D),N&&j.push((/^on /.test(j[j.length-1])?"":"on ")+N),X&&(y=/ ([\d.+]+)$/.exec(X),g=y&&"/"==X.charAt(X.length-y[0].length-1),X={architecture:32,family:y&&!g?X.replace(y[0],""):X,version:y?y[1]:null,toString:function(){var e=this.version;return this.family+(e&&!g?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(y=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(W))&&!/\bi686\b/i.test(W)?(X&&(X.architecture=64,X.family=X.family.replace(RegExp(" *"+y),"")),$&&(/\bWOW64\b/i.test(e)||G&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(e))&&j.unshift("32-bit")):X&&/^OS X/.test(X.family)&&"Chrome"==$&&parseFloat(U)>=39&&(X.architecture=64),e||(e=null);var L={};return L.description=e,L.layout=K&&K[0],L.manufacturer=D,L.name=$,L.prerelease=C,L.product=N,L.ua=e,L.version=$&&U,L.os=X||{architecture:null,family:null,version:null,toString:function(){return"null"}},L.parse=d,L.toString=function(){return this.description||""},L.version&&j.unshift(U),L.name&&j.unshift($),X&&$&&(X!=String(X).split(" ")[0]||X!=$.split(" ")[0]&&!N)&&j.push(N?"("+X+")":"on "+X),j.length&&(L.description=j.join(" ")),L}var h={function:!0,object:!0},f=h[typeof window]&&window||this,m=f,y=h.object&&r,g=h.object&&e&&!e.nodeType&&e,S=y&&g&&"object"==typeof t&&t;!S||S.global!==S&&S.window!==S&&S.self!==S||(f=S);var w=Math.pow(2,53)-1,x=/\bOpera/,v=this,O=Object.prototype,A=O.hasOwnProperty,P=O.toString,E=d();y&&g?a(E,function(e,t){y[t]=e}):f.platform=E}).call(t)});const n=e=>{throw new Error(e)},o={isString:e=>"string"==typeof e||e instanceof String,isBool:e=>"boolean"==typeof e,isInteger:e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,isPlainObject:e=>"object"==typeof e&&null!==e&&e.constructor===Object&&!1===e.hasOwnProperty("isPrototypeOf")&&"[object Object]"===e.toString()},s={options:e=>{if(o.isPlainObject(e))return!0;n("Invalid options object")},rating:e=>{if(o.isInteger(e)&&e>=-127&&e<=127)return e;n("Invalid or missing rating")},description:e=>{if(o.isString(e)&&e.trim().length>=3&&e.trim().length<=30)return e.trim();n("Invalid description")},comment:e=>{if(o.isString(e)&&e.trim().length>=3&&e.trim().length<=1e3)return e.trim();n("Invalid comment")},key:(e,t)=>{if(e&&o.isString(e.trim())&&32===e.trim().length)return e.trim();n("Invalid or missing "+t)},token:e=>{if(e&&o.isString(e)&&e.trim().length>0)return e.trim();n("Invalid or missing token")},url:e=>{const t=new RegExp(/^(ftp|http|https):\/\/[^ "]+$/);if(e&&o.isString(e)&&e.trim().length>0&&t.test(e.trim()))return e.trim();n("Invalid or missing api")},appVersion:e=>{if(e&&o.isString(e)&&e.trim().length>=1&&e.trim().length<=15)return e.trim();n("Invalid or missing version")},isMobile:e=>{if(void 0===e||null===e||o.isBool(e))return e;n("Invalid isMobile")},userAgent:e=>{if(o.isString(e)&&e.trim().length>0)return e.trim();n("Invalid userAgent")}};class a{constructor(e){s.options(e),this._keys={},this._versions={},this._screen={},this._keys.app=s.key(e.app,"app"),this._keys.platform=s.key(e.platform,"platform"),this._keys.range=s.key(e.range,"range"),this._appVersion=s.appVersion(e.version),this._url=s.url(e.api),this._token=s.token(e.token),this._userAgent=e.userAgent?s.userAgent(e.userAgent):window.navigator.userAgent,this._isMobile=s.isMobile(e.isMobile),this._platform=i.parse(this._userAgent)}get isMobile(){return void 0===this._isMobile||null===this._isMobile?r.any:this._isMobile}get app(){return{key:this._keys.app,version:this._appVersion}}get platform(){return{key:this._keys.platform,version:this._platform.os.version}}get device(){const e={name:this.isMobile?this._platform.product:"Desktop",screen:this.screen};return this.isMobile&&this._platform.manufacturer&&(e.brand=this._platform.manufacturer),e}get screen(){return{width:self.screen.width||window.screen.width,height:self.screen.height||window.screen.height}}get user(){if(this._user){const e={};return this._user.name&&(e.name=this._user.name),this._user.email&&(e.email=this._user.email),this._user.mibaId&&(e.mibaId=this._user.mibaId),e}}get browser(){return{name:this._platform.name,version:this._platform.version}}set user(e){const t=new RegExp(/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/),r=o.isPlainObject(e),i=o.isString(e.name)&&e.name.trim().length>0,s=o.isString(e.email)&&e.email.trim().length>0,a=o.isString(e.mibaId)&&e.mibaId.trim().length>0,l=(e.name.trim().length>=3&&e.name.trim().length,t.test(e.trim())&&e.email.trim().length>=3&&e.email.trim().length<=100),u=e.mibaId.trim().length>=1;r&&(i||s||a)||n("User object is invalid"),s&&l||a&&u?this._user=e:n("User has no valid email or mibaId")}set screen(e){const t=o.isPlainObject(e),r=o.isInteger(e.width)&&e>0,i=o.isInteger(e.width)&&e>0;t&&r&&i?this._screen=e:n("Screen object is invalid")}create(e){const t={rating:s.rating(e.rating),range:this._keys.range,app:this.app,platform:this.platform,device:this.device,browser:this.browser};return e.description&&(e.description=s.description(e.description)),e.comment&&(e.comment=s.comment(e.comment)),this.user&&(t.user=this.user),this.send(t)}send(e){const t={method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8",Accept:"application/json",Authorization:"Bearer "+this._token},body:JSON.stringify(e),mode:"no-cors"};return fetch(this._url,t)}}return a});
