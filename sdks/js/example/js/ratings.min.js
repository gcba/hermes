!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Ratings=t()}(this,function(){"use strict";function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e){function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function i(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return m.iterable&&(t[Symbol.iterator]=function(){return t}),t}function n(e){this.map={},e instanceof n?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function a(e){return new Promise(function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}})}function s(e){var t=new FileReader,i=a(t);return t.readAsArrayBuffer(e),i}function l(e){var t=new FileReader,i=a(t);return t.readAsText(e),i}function u(e){for(var t=new Uint8Array(e),i=new Array(t.length),r=0;r<t.length;r++)i[r]=String.fromCharCode(t[r]);return i.join("")}function c(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(m.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(m.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(m.arrayBuffer&&m.blob&&S(e))this._bodyArrayBuffer=c(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!m.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!v(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=c(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m.blob&&(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(s)}),this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(u(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},m.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function b(e,t){var i=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new n(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new n(t.headers)),this.method=f(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function d(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var i=e.split("="),r=i.shift().replace(/\+/g," "),n=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(n))}}),t}function h(e){var t=new n;return e.split(/\r?\n/).forEach(function(e){var i=e.split(":"),r=i.shift().trim();if(r){var n=i.join(":").trim();t.append(r,n)}}),t}function y(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new n(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var m={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(m.arrayBuffer)var g=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],S=function(e){return e&&DataView.prototype.isPrototypeOf(e)},v=ArrayBuffer.isView||function(e){return e&&g.indexOf(Object.prototype.toString.call(e))>-1};n.prototype.append=function(e,r){e=t(e),r=i(r);var n=this.map[e];this.map[e]=n?n+","+r:r},n.prototype.delete=function(e){delete this.map[t(e)]},n.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},n.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},n.prototype.set=function(e,r){this.map[t(e)]=i(r)},n.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)},n.prototype.keys=function(){var e=[];return this.forEach(function(t,i){e.push(i)}),r(e)},n.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),r(e)},n.prototype.entries=function(){var e=[];return this.forEach(function(t,i){e.push([i,t])}),r(e)},m.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},p.call(b.prototype),p.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e};var x=[301,302,303,307,308];y.redirect=function(e,t){if(-1===x.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})},e.Headers=n,e.Request=b,e.Response=y,e.fetch=function(e,t){return new Promise(function(i,r){var n=new b(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:h(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;i(new y(t,e))},o.onerror=function(){r(new TypeError("Network request failed"))},o.ontimeout=function(){r(new TypeError("Network request failed"))},o.open(n.method,n.url,!0),"include"===n.credentials&&(o.withCredentials=!0),"responseType"in o&&m.blob&&(o.responseType="blob"),n.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===n._bodyInit?null:n._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:void 0);var i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=e(function(e){!function(t){var i=/iPhone/i,r=/iPod/i,n=/iPad/i,o=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,a=/Android/i,s=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,l=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,u=/Windows Phone/i,c=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,p=/BlackBerry/i,f=/BB10/i,b=/Opera Mini/i,d=/(CriOS|Chrome)(?=.*\bMobile\b)/i,h=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,y=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),m=function(e,t){return e.test(t)},g=function(e){var t=e||navigator.userAgent,g=t.split("[FBAN");if(void 0!==g[1]&&(t=g[0]),void 0!==(g=t.split("Twitter"))[1]&&(t=g[0]),this.apple={phone:m(i,t),ipod:m(r,t),tablet:!m(i,t)&&m(n,t),device:m(i,t)||m(r,t)||m(n,t)},this.amazon={phone:m(s,t),tablet:!m(s,t)&&m(l,t),device:m(s,t)||m(l,t)},this.android={phone:m(s,t)||m(o,t),tablet:!m(s,t)&&!m(o,t)&&(m(l,t)||m(a,t)),device:m(s,t)||m(l,t)||m(o,t)||m(a,t)},this.windows={phone:m(u,t),tablet:m(c,t),device:m(u,t)||m(c,t)},this.other={blackberry:m(p,t),blackberry10:m(f,t),opera:m(b,t),firefox:m(h,t),chrome:m(d,t),device:m(p,t)||m(f,t)||m(b,t)||m(h,t)||m(d,t)},this.seven_inch=m(y,t),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},S=function(){var e=new g;return e.Class=g,e};e.exports&&"undefined"==typeof window?e.exports=g:e.exports&&"undefined"!=typeof window?e.exports=S():t.isMobile=S()}(i)}),n=e(function(e,t){(function(){function r(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function n(e,t,i){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&i&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&i&&(e=e.replace(RegExp(t,"i"),i)),e=a(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function o(e,t){var i=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=v)for(;++i<r;)t(e[i],i,e);else s(e,t)}function a(e){return e=f(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:r(e)}function s(e,t){for(var i in e)A.call(e,i)&&t(e[i],i,e)}function l(e){return null==e?r(e):O.call(e).slice(8,-1)}function u(e,t){var i=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(i)||"object"==i&&!e[t])}function c(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function p(e,t){var i=null;return o(e,function(r,n){i=t(i,r,n,e)}),i}function f(e){return String(e).replace(/^ +| +$/g,"")}function b(e){function t(t){return p(t,function(t,i){var r=i.pattern||c(i);return!t&&(t=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(i.label&&!RegExp(r,"i").test(i.label)?i.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),i=i.label||i,t=a(t[0].replace(RegExp(r,"i"),i).replace(RegExp("; *(?:"+i+"[_-])?","i")," ").replace(RegExp("("+i+")[-_.]?(\\w)","i"),"$1 $2"))),t})}var i=h,r=e&&"object"==typeof e&&"String"!=l(e);r&&(i=e,e=null);var o=i.navigator||{},d=o.userAgent||"";e||(e=d);var m,g,S=r||x==y,v=r?!!o.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(O.toString()),I=r?"Object":"ScriptBridgingProxyObject",A=r?"Object":"Environment",_=r&&i.java?"JavaPackage":l(i.java),E=r?"Object":"RuntimeObject",P=/\bJava/.test(_)&&i.java,M=P&&l(i.environment)==A,B=P?"a":"α",T=P?"b":"β",k=i.document||{},N=i.operamini||i.opera,R=w.test(R=r&&N?N["[[Class]]"]:l(N))?R:N=null,F=e,C=[],j=null,W=e==d,D=W&&N&&"function"==typeof N.version&&N.version(),L=function(t){return p(t,function(t,i){return t||RegExp("\\b"+(i.pattern||c(i))+"\\b","i").exec(e)&&(i.label||i)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),V=function(t){return p(t,function(t,i){return t||RegExp("\\b"+(i.pattern||c(i))+"\\b","i").exec(e)&&(i.label||i)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),G=t([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),U=function(t){return p(t,function(t,i,r){return t||(i[G]||i[/^[a-z]+(?: +[a-z]+\b)*/i.exec(G)]||RegExp("\\b"+c(r)+"(?:\\b|\\w*\\d)","i").exec(e))&&r})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),K=function(t){return p(t,function(t,i){var r=i.pattern||c(i);return!t&&(t=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=n(t,r,i.label||i)),t})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(L&&(L=[L]),U&&!G&&(G=t([U])),(m=/\bGoogle TV\b/.exec(G))&&(G=m[0]),/\bSimulator\b/i.test(e)&&(G=(G?G+" ":"")+"Simulator"),"Opera Mini"==V&&/\bOPiOS\b/.test(e)&&C.push("running in Turbo/Uncompressed mode"),"IE"==V&&/\blike iPhone OS\b/.test(e)?(U=(m=b(e.replace(/like iPhone OS/,""))).manufacturer,G=m.product):/^iP/.test(G)?(V||(V="Safari"),K="iOS"+((m=/ OS ([\d_]+)/i.exec(e))?" "+m[1].replace(/_/g,"."):"")):"Konqueror"!=V||/buntu/i.test(K)?U&&"Google"!=U&&(/Chrome/.test(V)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(G))||/\bAndroid\b/.test(K)&&/^Chrome/.test(V)&&/\bVersion\//i.test(e)?(V="Android Browser",K=/\bAndroid\b/.test(K)?K:"Android"):"Silk"==V?(/\bMobi/i.test(e)||(K="Android",C.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&C.unshift("accelerated")):"PaleMoon"==V&&(m=/\bFirefox\/([\d.]+)\b/.exec(e))?C.push("identifying as Firefox "+m[1]):"Firefox"==V&&(m=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(K||(K="Firefox OS"),G||(G=m[1])):!V||(m=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(V))?(V&&!G&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(m+"/")+8))&&(V=null),(m=G||U||K)&&(G||U||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(K))&&(V=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(K)?K:m)+" Browser")):"Electron"==V&&(m=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&C.push("Chromium "+m):K="Kubuntu",D||(D=function(t){return p(t,function(t,i){return t||(RegExp(i+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",c(V),"(?:Firefox|Minefield|NetFront)"])),(m="iCab"==L&&parseFloat(D)>3&&"WebKit"||/\bOpera\b/.test(V)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(e)&&("Mac OS"==K?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(V)&&"NetFront")&&(L=[m]),"IE"==V&&(m=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(V+=" Mobile",K="Windows Phone "+(/\+$/.test(m)?m:m+".x"),C.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(V="IE Mobile",K="Windows Phone 8.x",C.unshift("desktop mode"),D||(D=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=V&&"Trident"==L&&(m=/\brv:([\d.]+)/.exec(e))&&(V&&C.push("identifying as "+V+(D?" "+D:"")),V="IE",D=m[1]),W){if(u(i,"global"))if(P&&(F=(m=P.lang.System).getProperty("os.arch"),K=K||m.getProperty("os.name")+" "+m.getProperty("os.version")),S&&u(i,"system")&&(m=[i.system])[0]){K||(K=m[0].os||null);try{m[1]=i.require("ringo/engine").version,D=m[1].join("."),V="RingoJS"}catch(e){m[0].global.system==i.system&&(V="Narwhal")}}else"object"==typeof i.process&&!i.process.browser&&(m=i.process)?"object"==typeof m.versions?"string"==typeof m.versions.electron?(C.push("Node "+m.versions.node),V="Electron",D=m.versions.electron):"string"==typeof m.versions.nw&&(C.push("Chromium "+D,"Node "+m.versions.node),V="NW.js",D=m.versions.nw):(V="Node.js",F=m.arch,K=m.platform,D=(D=/[\d.]+/.exec(m.version))?D[0]:"unknown"):M&&(V="Rhino");else l(m=i.runtime)==I?(V="Adobe AIR",K=m.flash.system.Capabilities.os):l(m=i.phantom)==E?(V="PhantomJS",D=(m=m.version||null)&&m.major+"."+m.minor+"."+m.patch):"number"==typeof k.documentMode&&(m=/\bTrident\/(\d+)/i.exec(e))?(D=[D,k.documentMode],(m=+m[1]+4)!=D[1]&&(C.push("IE "+D[1]+" mode"),L&&(L[1]=""),D[1]=m),D="IE"==V?String(D[1].toFixed(1)):D[0]):"number"==typeof k.documentMode&&/^(?:Chrome|Firefox)\b/.test(V)&&(C.push("masking as "+V+" "+D),V="IE",D="11.0",L=["Trident"],K="Windows");K=K&&a(K)}if(D&&(m=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(D)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(W&&o.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(j=/b/i.test(m)?"beta":"alpha",D=D.replace(RegExp(m+"\\+?$"),"")+("beta"==j?T:B)+(/\d+\+?/.exec(m)||"")),"Fennec"==V||"Firefox"==V&&/\b(?:Android|Firefox OS)\b/.test(K))V="Firefox Mobile";else if("Maxthon"==V&&D)D=D.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(G))"Xbox 360"==G&&(K=null),"Xbox 360"==G&&/\bIEMobile\b/.test(e)&&C.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(V)&&(!V||G||/Browser|Mobi/.test(V))||"Windows CE"!=K&&!/Mobi/i.test(e))if("IE"==V&&W)try{null===i.external&&C.unshift("platform preview")}catch(e){C.unshift("embedded")}else(/\bBlackBerry\b/.test(G)||/\bBB10\b/.test(e))&&(m=(RegExp(G.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||D)?(K=((m=[m,/BB10/.test(e)])[1]?(G=null,U="BlackBerry"):"Device Software")+" "+m[0],D=null):this!=s&&"Wii"!=G&&(W&&N||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==V&&/\bOS X (?:\d+\.){2,}/.test(K)||"IE"==V&&(K&&!/^Win/.test(K)&&D>5.5||/\bWindows XP\b/.test(K)&&D>8||8==D&&!/\bTrident\b/.test(e)))&&!w.test(m=b.call(s,e.replace(w,"")+";"))&&m.name&&(m="ing as "+m.name+((m=m.version)?" "+m:""),w.test(V)?(/\bIE\b/.test(m)&&"Mac OS"==K&&(K=null),m="identify"+m):(m="mask"+m,V=R?a(R.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(m)&&(K=null),W||(D=null)),L=["Presto"],C.push(m));else V+=" Mobile";(m=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(m=[parseFloat(m.replace(/\.(\d)$/,".0$1")),m],"Safari"==V&&"+"==m[1].slice(-1)?(V="WebKit Nightly",j="alpha",D=m[1].slice(0,-1)):D!=m[1]&&D!=(m[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(D=null),m[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==m[0]&&537.36==m[2]&&parseFloat(m[1])>=28&&"WebKit"==L&&(L=["Blink"]),W&&(v||m[1])?(L&&(L[1]="like Chrome"),m=m[1]||((m=m[0])<530?1:m<532?2:m<532.05?3:m<533?4:m<534.03?5:m<534.07?6:m<534.1?7:m<534.13?8:m<534.16?9:m<534.24?10:m<534.3?11:m<535.01?12:m<535.02?"13+":m<535.07?15:m<535.11?16:m<535.19?17:m<536.05?18:m<536.1?19:m<537.01?20:m<537.11?"21+":m<537.13?23:m<537.18?24:m<537.24?25:m<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),m=(m=m[0])<400?1:m<500?2:m<526?3:m<533?4:m<534?"4+":m<535?5:m<537?6:m<538?7:m<601?8:"8"),L&&(L[1]+=" "+(m+="number"==typeof m?".x":/[.+]/.test(m)?"":"+")),"Safari"==V&&(!D||parseInt(D)>45)&&(D=m)),"Opera"==V&&(m=/\bzbov|zvav$/.exec(K))?(V+=" ",C.unshift("desktop mode"),"zvav"==m?(V+="Mini",D=null):V+="Mobile",K=K.replace(RegExp(" *"+m+"$"),"")):"Safari"==V&&/\bChrome\b/.exec(L&&L[1])&&(C.unshift("desktop mode"),V="Chrome Mobile",D=null,/\bOS X\b/.test(K)?(U="Apple",K="iOS 4.3+"):K=null),D&&0==D.indexOf(m=/[\d.]+$/.exec(K))&&e.indexOf("/"+m+"-")>-1&&(K=f(K.replace(m,""))),L&&!/\b(?:Avant|Nook)\b/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||"Safari"!=V&&/^iOS/.test(K)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(V)&&L[1])&&(m=L[L.length-1])&&C.push(m),C.length&&(C=["("+C.join("; ")+")"]),U&&G&&G.indexOf(U)<0&&C.push("on "+U),G&&C.push((/^on /.test(C[C.length-1])?"":"on ")+G),K&&(m=/ ([\d.+]+)$/.exec(K),g=m&&"/"==K.charAt(K.length-m[0].length-1),K={architecture:32,family:m&&!g?K.replace(m[0],""):K,version:m?m[1]:null,toString:function(){var e=this.version;return this.family+(e&&!g?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(m=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(F))&&!/\bi686\b/i.test(F)?(K&&(K.architecture=64,K.family=K.family.replace(RegExp(" *"+m),"")),V&&(/\bWOW64\b/i.test(e)||W&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(e))&&C.unshift("32-bit")):K&&/^OS X/.test(K.family)&&"Chrome"==V&&parseFloat(D)>=39&&(K.architecture=64),e||(e=null);var $={};return $.description=e,$.layout=L&&L[0],$.manufacturer=U,$.name=V,$.prerelease=j,$.product=G,$.ua=e,$.version=V&&D,$.os=K||{architecture:null,family:null,version:null,toString:function(){return"null"}},$.parse=b,$.toString=function(){return this.description||""},$.version&&C.unshift(D),$.name&&C.unshift(V),K&&V&&(K!=String(K).split(" ")[0]||K!=V.split(" ")[0]&&!G)&&C.push(G?"("+K+")":"on "+K),C.length&&($.description=C.join(" ")),$}var d={function:!0,object:!0},h=d[typeof window]&&window||this,y=h,m=d.object&&t,g=d.object&&e&&!e.nodeType&&e,S=m&&g&&"object"==typeof i&&i;!S||S.global!==S&&S.window!==S&&S.self!==S||(h=S);var v=Math.pow(2,53)-1,w=/\bOpera/,x=this,I=Object.prototype,A=I.hasOwnProperty,O=I.toString,_=b();m&&g?s(_,function(e,t){m[t]=e}):h.platform=_}).call(i)}),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=[],l=function(e,t){s.push({message:e,type:t})},u={isString:function(e){return"string"==typeof e||e instanceof String},isBool:function(e){return"boolean"==typeof e},isInteger:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},isPlainObject:function(e){return"object"===(void 0===e?"undefined":a(e))&&null!==e&&e.constructor===Object&&!1===e.hasOwnProperty("isPrototypeOf")&&"[object Object]"===e.toString()}},c={options:function(e){if(u.isPlainObject(e))return!0;l("invalid options object","INVALID_OPTIONS")},rating:function(e){if(u.isInteger(e)&&e>=-127&&e<=127)return e;l("invalid rating","INVALID_RATING")},description:function(e){var t="INVALID_DESCRIPTION";if(u.isString(e)){var i=e.trim();return i.length<3&&l("description too short",t),i.length>30&&l("description too long",t),i}l("invalid description",t)},comment:function(e){if(u.isString(e)){var t=e.trim();return t.length<3&&l("comment too short","INVALID_COMMENT"),t.length>1e3&&l("comment too long","INVALID_COMMENT"),t}l("invalid comment","INVALID_COMMENT")},key:function(e,t){if(e&&u.isString(e.trim())&&32===e.trim().length)return e.trim();l("invalid "+t,"INVALID_"+t.toUpperCase())},token:function(e){if(e&&u.isString(e)&&e.trim().length>0)return e.trim();l("invalid token","INVALID_TOKEN")},url:function(e){var t=new RegExp(/^(ftp|http|https):\/\/[^ "]+$/);if(e&&u.isString(e)&&t.test(e.trim())){var i=e.trim();return"/"===i[i.length-1]?i+"ratings":i+"/ratings"}l("invalid endpoint","INVALID_ENDPOINT")},appVersion:function(e){if(u.isString(e)){var t=e.trim();return t.length<1&&l("version too short","INVALID_VERSION"),t.length>15&&l("version too long","INVALID_VERSION"),t}l("invalid version","INVALID_VERSION")},isMobile:function(e){if(void 0===e||null===e||u.isBool(e))return e;l("invalid isMobile","INVALID_IS_MOBILE")},userAgent:function(e){if(u.isString(e)&&e.trim().length>0)return e.trim();l("invalid userAgent","INVALID_USER_AGENT")},name:function(e){if(u.isString(e)){var t=e.trim();return t.length<3&&l("name too short","INVALID_NAME"),t.length>70&&l("name too long","INVALID_NAME"),t}l("invalid name","INVALID_NAME")},email:function(e){var t=new RegExp(/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/);if(u.isString(e)&&t.test(e.trim())){var i=e.trim();return i.length<3&&l("email too short","INVALID_EMAIL"),i.length>100&&l("email too long","INVALID_EMAIL"),i}l("invalid email","INVALID_EMAIL")},mibaId:function(e){if(u.isString(e)&&36===e.length)return e.trim();l("invalid mibaId","INVALID_MIBAID")}};!function(){function e(i){t(this,e),this.message=i,this.name="RatingError"}o(e,[{key:"toString",value:function(){return this.name+": "+this.message}}])}();return function(){function e(i){t(this,e),c.options(i),this._keys={},this._versions={},this._screen={},this._keys.app=c.key(i.app,"app"),this._keys.platform=c.key(i.platform,"platform"),this._keys.range=c.key(i.range,"range"),this._appVersion=c.appVersion(i.version),this._url=c.url(i.api),this._token=c.token(i.token),this._userAgent=i.userAgent?c.userAgent(i.userAgent):window.navigator.userAgent,this._isMobile=c.isMobile(i.isMobile),this._platform=n.parse(this._userAgent)}return o(e,[{key:"create",value:function(e){var t={rating:c.rating(e.rating),range:this._keys.range,app:this.app,platform:this.platform,device:this.device,browser:this.browser};return e.description&&(t.description=c.description(e.description)),e.comment&&(t.comment=c.comment(e.comment)),this.user&&(t.user=this.user),this.send(t)}},{key:"send",value:function(e){var t=this,i={method:"POST",headers:new Headers({"Content-Type":"application/json; charset=UTF-8",Accept:"application/json",Authorization:"Bearer "+this._token}),body:JSON.stringify(e)};return new Promise(function(e,t){0==s.length?e():t(s.slice(0)),s=[]}).then(function(){return fetch(t._url,i)}).then(function(e){return e.json()})}},{key:"isMobile",get:function(){return void 0===this._isMobile||null===this._isMobile?r.any:this._isMobile}},{key:"app",get:function(){return{key:this._keys.app,version:this._appVersion}}},{key:"platform",get:function(){return{key:this._keys.platform,version:this._platform.os.version}}},{key:"device",get:function(){var e={name:this.isMobile?this._platform.product:"Desktop",screen:this.screen};return this.isMobile&&this._platform.manufacturer&&(e.brand=this._platform.manufacturer),e}},{key:"screen",get:function(){return{width:self.screen.width||window.screen.width,height:self.screen.height||window.screen.height}},set:function(e){var t=u.isPlainObject(e),i=u.isInteger(e.width)&&e>0,r=u.isInteger(e.width)&&e>0;t&&i&&r||l("screen object is invalid","INVALID_SCREEN"),this._screen=e}},{key:"user",get:function(){if(this._user){var e={};return this._user.name&&(e.name=this._user.name),this._user.email&&(e.email=this._user.email),this._user.mibaId&&(e.mibaId=this._user.mibaId),e}},set:function(e){var t=u.isPlainObject(e),i=u.isString(e.name)&&e.name.trim().length>0,r=u.isString(e.email)&&e.email.trim().length>0,n=u.isString(e.mibaId)&&e.mibaId.trim().length>0,o=c.name(e.name),a=c.email(e.email),s={};t&&(i||r||n)||l("user object is invalid","INVALID_USER"),i&&(s.name=o),r&&(s.email=a),n&&(s.mibaId=c.mibaId(e.mibaId)),this._user=s}},{key:"browser",get:function(){return{name:this._platform.name,version:this._platform.version}}}]),e}()});
